<section class="container">
  <h2 class="mb-2">Adivino tu pel√≠cula</h2>

  <p class="lead text-secondary mb-3">
    üé¨ Cu√©ntame una escena, una frase, un actor o cualquier detalle que recuerdes y tratar√© de adivinar el t√≠tulo.
    Entre m√°s preciso seas (√©poca, lugar, tono), ¬°mejor el resultado!
  </p>

  <div class="mb-3">
    <small class="text-secondary d-block mb-2">Sugerencias r√°pidas:</small>
    <div class="d-flex flex-wrap gap-2">
      <button type="button" class="btn btn-sm btn-outline-warning"
        (click)="description='Un cient√≠fico viaja al pasado usando un auto modificado para arreglar la vida de sus padres'">
        Viajes en el tiempo
      </button>
      <button type="button" class="btn btn-sm btn-outline-info"
        (click)="description='Un grupo debe destruir un anillo maldito arroj√°ndolo a un volc√°n mientras son perseguidos por criaturas oscuras'">
        Fantas√≠a √©pica
      </button>
      <button type="button" class="btn btn-sm btn-outline-danger"
        (click)="description='Un tibur√≥n gigante aterroriza a los ba√±istas de una tranquila isla tur√≠stica en verano'">
        Terror en la playa
      </button>
      <button type="button" class="btn btn-sm btn-outline-success"
        (click)="description='Una tripulaci√≥n espacial responde a una se√±al misteriosa y desata una amenaza letal a bordo'">
        Sci‚ÄëFi claustrof√≥bico
      </button>
      <button type="button" class="btn btn-sm btn-outline-primary"
        (click)="description='Un ladr√≥n entra en los sue√±os de las personas para implantar una idea en la mente de un ejecutivo'">
        Sue√±os dentro de sue√±os
      </button>
    </div>
  </div>

  <form class="bg-dark border border-secondary rounded p-3" (ngSubmit)="onSubmit()">
    <div class="mb-3">
      <label class="form-label">Descripci√≥n o algo que pasa</label>
      <textarea class="form-control bg-dark text-light" rows="3" [(ngModel)]="description" name="description" placeholder="Ej: Un arque√≥logo aventurero busca un artefacto antiguo" required></textarea>
    </div>

    <!-- Campos adicionales removidos seg√∫n contrato del backend (solo descripci√≥n) -->

    <div class="mt-3 d-flex gap-2">
      <button class="btn btn-primary" type="submit" [disabled]="loading">{{ loading ? 'Buscando...' : 'Adivinar' }}</button>
      <button class="btn btn-outline-secondary" type="button" (click)="reset()" [disabled]="loading">Limpiar</button>
    </div>
  </form>

  <div class="mt-4" *ngIf="error" >
    <div class="alert alert-danger">{{ error }}</div>
  </div>

  <div class="mt-4" *ngIf="result">
    <div class="card bg-dark border-secondary">
      <div class="row g-0">
        <div class="col-12 col-md-3" *ngIf="result.poster">
          <img [src]="result.poster" class="img-fluid rounded-start" alt="Poster" />
        </div>
        <div class="col">
          <div class="card-body">
            <h5 class="card-title">
              {{ result.title }} <small class="text-secondary" *ngIf="result.year">({{ result.year }})</small>
            </h5>
            <p class="card-text text-secondary" *ngIf="result.plot">{{ result.plot }}</p>
            <p class="card-text" *ngIf="result.confidence !== undefined">
              <small class="text-info">Confianza: {{ (result.confidence * 100) | number:'1.0-0' }}%</small>
            </p>
            <div *ngIf="result.suggestions?.length">
              <small class="text-secondary d-block mb-1">Sugerencias relacionadas:</small>
              <div class="d-flex flex-wrap gap-2">
                <span class="badge text-bg-info" *ngFor="let s of result.suggestions">{{ s }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Candidatos siempre visibles si hay resultados de la API -->
  <div class="mt-4" *ngIf="candidates?.length">
    <h5 class="mb-2 text-secondary">Candidatos</h5>
    <div class="row g-3">
      <div class="col-12 col-sm-6 col-lg-4 col-xxl-3" *ngFor="let c of candidates">
        <div class="card h-100 bg-dark border-secondary">
          <img *ngIf="c.poster" [src]="c.poster" class="card-img-top" [alt]="c.title" />
          <div class="card-body">
            <h6 class="card-title">{{ c.title }} <small class="text-secondary" *ngIf="c.year">({{ c.year }})</small></h6>
            <p class="card-text mb-2" *ngIf="c.actors"><small class="text-secondary">{{ c.actors }}</small></p>
            <a class="btn btn-sm btn-outline-info" *ngIf="c.imdbUrl" [href]="c.imdbUrl" target="_blank" rel="noopener">Ver en IMDb</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
